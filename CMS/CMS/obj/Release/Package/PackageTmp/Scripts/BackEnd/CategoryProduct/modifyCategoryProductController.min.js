admin.controller("modifyCategoryProductController",["$scope","$http","$window","$location","$filter","Alias","Url",function(n,t,r,u,f,e,o){function h(){l();n.categoryProduct.id!==null?a(n.categoryProduct.id):c()}function c(){n.categoryProduct={published:!0,version:1,robots:"Index, Follow",colorBackgroundBanner:"#000000",colorTitleBanner:"#ffffff",colorTextBanner:"#ffffff",timePublished:new Date}}function l(){t.get("/CategoryProduct/GetAll").then(function(t){t.status==200&&(n.tempCategoryProducts=angular.copy(t.data),angular.forEach(n.tempCategoryProducts,function(n){s(n,0)}))},function(){})}function a(){t.get(apiCategoryProduct+"/"+n.categoryProduct.id).then(function(t){t.status==200?(n.categoryProduct=angular.copy(t.data),n.categoryProduct.timePublished=new Date(n.categoryProduct.timePublished)):r.location.href="/Admin/CategoryProduct"},function(){r.location.href="/Admin/CategoryProduct"})}function s(t,r){if(n.categoryProducts.indexOf(t)==-1){for(i=1;i<=r;i++)t.title="– "+t.title;r++;n.categoryProducts.push(t);angular.forEach(n.tempCategoryProducts,function(n){n.idParentCategory==t.id&&s(n,r)})}}apiCategoryProduct="/API/CategoryProductAPI";n.categoryProducts=[];n.tempCategoryProducts=[];n.categoryProduct={};n.statuses=[{text:"Xuất bản",value:!0},{text:"Không xuất bản",value:!1}];n.isServices=[{text:"Có",value:!0},{text:"Không",value:!1}];n.categoryProduct.id=o.getParameterByName("idCategoryProduct");h();n.Save=function(){n.categoryProduct.id==null?t.post(apiCategoryProduct,n.categoryProduct).then(function(t){t.status==201?(n.categoryProduct=angular.copy(t.data),toastr.success("Thành công","Thêm Danh mục Sản phẩm"),r.location.href="/Admin/CategoryProduct/Modify?idCategoryProduct="+n.categoryProduct.id):toastr.error("Thất bại","Thêm Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Thêm Danh mục Sản phẩm")}):t.put(apiCategoryProduct+"/"+n.categoryProduct.id,n.categoryProduct).then(function(n){n.status==204?toastr.success("Thành công","Lưu Danh mục Sản phẩm"):toastr.error("Thất bại","Lưu Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Lưu Danh mục Sản phẩm")})};n.SaveAndExit=function(){n.categoryProduct.id==null?t.post(apiCategoryProduct,n.categoryProduct).then(function(t){t.status==201?(n.categoryProduct=angular.copy(t.data),toastr.success("Thành công","Thêm Danh mục Sản phẩm"),r.location.href="/Admin/CategoryProduct"):toastr.error("Thất bại","Thêm Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Thêm Danh mục Sản phẩm")}):t.put(apiCategoryProduct+"/"+n.categoryProduct.id,n.categoryProduct).then(function(n){n.status==204?(toastr.success("Thành công","Lưu Danh mục Sản phẩm"),r.location.href="/Admin/CategoryProduct"):toastr.error("Thất bại","Lưu Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Lưu Danh mục Sản phẩm")})};n.SaveAndAdd=function(){n.categoryProduct.id==null?t.post(apiCategoryProduct,n.categoryProduct).then(function(t){t.status==201?(n.categoryProduct=angular.copy(t.data),toastr.success("Thành công","Thêm Danh mục Sản phẩm"),r.location.href="/Admin/CategoryProduct/Modify"):toastr.error("Thất bại","Thêm Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Thêm Danh mục Sản phẩm")}):t.put(apiCategoryProduct+"/"+n.categoryProduct.id,n.categoryProduct).then(function(n){n.status==204?(toastr.success("Thành công","Lưu Danh mục Sản phẩm"),r.location.href="/Admin/CategoryProduct/Modify"):toastr.error("Thất bại","Lưu Danh mục Sản phẩm")},function(){toastr.error("Thất bại","Lưu Danh mục Sản phẩm")})};n.Cancel=function(){r.location.href="/Admin/CategoryProduct"};n.ChooseImage=function(){var t=new CKFinder;t.selectActionFunction=function(t){n.categoryProduct.image=t;n.$apply()};t.SelectFunction="ShowFileInfo";t.popup()};n.ChooseImageBanner=function(){var t=new CKFinder;t.selectActionFunction=function(t){n.categoryProduct.imageBanner=t;n.$apply()};t.SelectFunction="ShowFileInfo";t.popup()};n.GenAlias=function(){n.categoryProduct.alias=angular.copy(e.genAlias(n.categoryProduct.title))}}]);