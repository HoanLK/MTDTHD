admin.controller("modifyAlbumController",["$scope","$http","$window","$location","$filter","Alias","Url",function(n,t,i,r,u,f,e){function o(){n.album.id!==null?h(n.album.id):s()}function s(){n.album={published:!0,timeCreated:new Date}}function h(){t.get(apiAlbum+"/"+n.album.id).then(function(i){n.album=angular.copy(i.data);t.get(apiItemAlbum+"?att=idAlbum&&value="+n.album.id).then(function(t){n.items=angular.copy(t.data)},function(){toastr.error("Thất bại","Lấy danh sách ảnh")})},function(){i.location.href="/Admin/Album"})}apiAlbum="/API/AlbumAPI";n.album={};n.items=[];n.item={};apiItemAlbum="/API/ItemAlbumAPI";n.statuses=[{text:"Xuất bản",value:!0},{text:"Không xuất bản",value:!1}];n.album.id=e.getParameterByName("idAlbum");n.modifyItem=!1;n.titlePopupModifyItem="Thêm hình ảnh";n.popupModifyItem={maxWidth:600,height:"auto",contentTemplate:"templateModifyItem",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyItem",visible:"modifyItem"}};n.deleteItem=!1;n.titleDeleteItem="Bạn có chắc chắn muốn xóa?";n.popupDeleteItem={width:"auto",height:"auto",contentTemplate:"templateDeleteItem",showTitle:!1,bindingOptions:{visible:"deleteItem"}};n.controlItem={title:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"item.title"}},description:{height:150,valueChangeEvent:"keyup",bindingOptions:{value:"item.description"}}};o();n.Save=function(){n.album.id==null?t.post(apiAlbum,n.album).then(function(r){n.album=angular.copy(r.data);angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})});toastr.success("Thành công","Thêm Album");i.location.href="/Admin/Album/Modify?idAlbum="+n.album.id},function(){toastr.error("Thất bại","Thêm Album")}):t.put(apiAlbum+"/"+n.album.id,n.album).then(function(){t.get("/Admin/Album/DeleteItemByAlbum/"+n.album.id).then(function(i){i.data=="1"?angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})}):toastr.error("Thất bại","Lưu ảnh")},function(){toastr.error("Thất bại","Lưu ảnh")});toastr.success("Thành công","Lưu Album")},function(){toastr.error("Thất bại","Lưu Album")})};n.SaveAndExit=function(){n.album.id==null?t.post(apiAlbum,n.album).then(function(r){n.album=angular.copy(r.data);angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})});toastr.success("Thành công","Thêm Album");i.location.href="/Admin/Album"},function(){toastr.error("Thất bại","Thêm Album")}):t.put(apiAlbum+"/"+n.album.id,n.album).then(function(){t.get("/Admin/Album/DeleteItemByAlbum/"+n.album.id).then(function(i){i.data=="1"?angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})}):toastr.error("Thất bại","Lưu ảnh")},function(){toastr.error("Thất bại","Lưu ảnh")});toastr.success("Thành công","Lưu Album");i.location.href="/Admin/Album"},function(){toastr.error("Thất bại","Lưu Album")})};n.SaveAndAdd=function(){n.album.id==null?t.post(apiAlbum,n.album).then(function(r){n.album=angular.copy(r.data);angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})});toastr.success("Thành công","Thêm Album");i.location.href="/Admin/Album/Modify"},function(){toastr.error("Thất bại","Thêm Album")}):t.put(apiAlbum+"/"+n.album.id,n.album).then(function(){t.get("/Admin/Album/DeleteItemByAlbum/"+n.album.id).then(function(i){i.data=="1"?angular.forEach(n.items,function(i){i.idAlbum=angular.copy(n.album.id);t.post(apiItemAlbum,i).then(function(n){i=angular.copy(n.data)},function(){})}):toastr.error("Thất bại","Lưu ảnh")},function(){toastr.error("Thất bại","Lưu ảnh")});toastr.success("Thành công","Lưu Album");i.location.href="/Admin/Album/Modify"},function(){toastr.error("Thất bại","Lưu Album")})};n.Cancel=function(){i.location.href="/Admin/Album"};n.AddItem=function(){n.modifyItem=!0;n.item={colorBackground:"#ffffff",colorText:"#000000"}};n.SaveItem=function(){n.modifyItem=!1;angular.isDefined(n.item.index)?n.items[n.item.index]=angular.copy(n.item):n.items.push(n.item);n.item={}};n.CancelSaveMenu=function(){n.modifyItem=!1;n.item={}};n.EditItem=function(t){n.modifyItem=!0;n.item=angular.copy(n.items[t]);n.item.index=angular.copy(t)};n.DeleteItem=function(t){n.deleteItem=!0;n.item=angular.copy(n.items[t]);n.item.index=angular.copy(t)};n.ConfirmDeleteItem=function(){n.deleteItem=!1;n.items.splice(n.item.index,1)};n.CancelDeleteItem=function(){n.deleteItem=!1};n.ChooseImage=function(){var t=new CKFinder;t.selectActionFunction=function(t){n.album.image=t;n.$apply()};t.SelectFunction="ShowFileInfo";t.popup()};n.ChooseImageItem=function(){var t=new CKFinder;t.selectActionFunction=function(t){n.item.image=t;n.$apply()};t.SelectFunction="ShowFileInfo";t.popup()};n.GenAlias=function(){n.album.alias=angular.copy(f.genAlias(n.album.title))}}]);